<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}Eyes of an Addict | Recovery Community{% endblock %}</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/feather-icons@4/feather.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="container-fluid" style="position: relative;">
        <ul>
            <li>
                <!-- Navigation links only -->
            </li>
        </ul>
        <!-- The logo and text are now part of the background image -->
        <ul>
            <li><a href="{{ url_for('index') }}#features">Features</a></li>
            <li><a href="{{ url_for('products') }}">Shop</a></li>
            <li><a href="{{ url_for('faq') }}">FAQ</a></li>
            <li><a href="{{ url_for('contact') }}">Contact</a></li>
            {% if current_user.is_authenticated %}
                <li><a href="{{ url_for('dashboard') }}">My Journal</a></li>
                <li><a href="{{ url_for('logout') }}">Logout</a></li>
            {% else %}
                <li><a href="{{ url_for('login') }}">Login</a></li>
                <li><a href="{{ url_for('register') }}" role="button">Subscribe</a></li>
            {% endif %}
        </ul>
    </nav>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="container">
                {% for category, message in messages %}
                    <div class="alert alert-{{ 'success' if category == 'success' else 'error' }}" style="padding: 1rem; margin: 1rem 0; border-radius: 0.5rem; background-color: {{ '#d4edda' if category == 'success' else '#f8d7da' }}; border: 1px solid {{ '#c3e6cb' if category == 'success' else '#f5c6cb' }};">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <!-- Error Message Display -->
    {% if error_message %}
        <div class="container">
            <article style="text-align: center; padding: 2rem;">
                <h2>Oops!</h2>
                <p>{{ error_message }}</p>
                <a href="{{ url_for('index') }}" role="button">Return Home</a>
            </article>
        </div>
    {% endif %}

    <!-- Main Content -->
    {% block content %}{% endblock %}

    <!-- Footer -->
    <footer class="container">
        <small>
            <a href="https://baileytrends.com" target="_blank">Bailey Trends</a> â€¢ 
            <a href="{{ url_for('index') }}">Eyes of an Addict</a>
        </small>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <script>feather.replace()</script>
    
    <!-- Journal Preview Modal JavaScript -->
    <script>
        // Journal page data
        const journalPages = [
            {
                image: 'journal-cover.jpg',
                title: 'Recovery Journal Cover',
                description: 'Your comprehensive guide through the critical first 30 days of recovery'
            },
            {
                image: 'journal-page1.jpg',
                title: 'Day 1: Starting Your Journey',
                description: 'Setting intentions and understanding what recovery means to you'
            },
            {
                image: 'journal-page2.jpg',
                title: 'Week 1: Building Foundation',
                description: 'Daily check-ins, mood tracking, and establishing healthy routines'
            },
            {
                image: 'journal-page3.jpg',
                title: 'Week 2: Developing Strength',
                description: 'Coping strategies, trigger identification, and support network building'
            },
            {
                image: 'journal-page4.jpg',
                title: 'Progress Tracking',
                description: 'Milestone celebrations, reflection exercises, and goal setting'
            }
        ];

        let currentPageIndex = 0;

        function openJournalModal() {
            document.getElementById('journalModal').style.display = 'block';
            updatePage();
        }

        function closeJournalModal() {
            document.getElementById('journalModal').style.display = 'none';
        }

        function nextPage() {
            if (currentPageIndex < journalPages.length - 1) {
                currentPageIndex++;
                updatePage();
            }
        }

        function previousPage() {
            if (currentPageIndex > 0) {
                currentPageIndex--;
                updatePage();
            }
        }

        function updatePage() {
            const page = journalPages[currentPageIndex];
            const baseUrl = '{{ url_for("static", filename="images/") }}';
            
            document.getElementById('currentJournalPage').src = baseUrl + page.image;
            document.getElementById('pageTitle').textContent = page.title;
            document.getElementById('pageDescription').textContent = page.description;
            document.getElementById('currentPage').textContent = currentPageIndex + 1;
            
            // Update navigation buttons
            document.getElementById('prevBtn').disabled = currentPageIndex === 0;
            document.getElementById('nextBtn').disabled = currentPageIndex === journalPages.length - 1;
        }

        // Close modal when clicking outside of it
        window.onclick = function(event) {
            const modal = document.getElementById('journalModal');
            if (event.target === modal) {
                closeJournalModal();
            }
        }

        // Keyboard navigation
        document.addEventListener('keydown', function(event) {
            const modal = document.getElementById('journalModal');
            if (modal && modal.style.display === 'block') {
                if (event.key === 'ArrowRight') {
                    nextPage();
                } else if (event.key === 'ArrowLeft') {
                    previousPage();
                } else if (event.key === 'Escape') {
                    closeJournalModal();
                }
            }
        });
    </script>
</body>
</html>
